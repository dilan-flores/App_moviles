"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[541],{5223:(A,h,g)=>{g.r(h),g.d(h,{ChatPageModule:()=>w});var c=g(6814),l=g(95),i=g(1929),d=g(2891),e=g(9212),m=g(2389),f=g(3894),p=g(4664),C=g(7398),v=g(830),M=g(7104);let P=(()=>{var t;class r{constructor(o,a,n){this.authService=o,this.storage=a,this.afs=n,this.currentUser=this.authService.currentUser}addChatMessage({msg:o}){return this.afs.collection("messages").add({msg:o,from:this.currentUser.email,createdAt:(0,f.Bt)()})}getChatMessages(){let o=[];return this.getUsers().pipe((0,p.w)(a=>(o=a,this.afs.collection("messages",n=>n.orderBy("createdAt")).valueChanges({idField:"id"}))),(0,C.U)(a=>{for(let n of a)n.fromName=this.getUserForMsg(n.from,o),n.myMsg=this.currentUser.email===n.from;return a}))}getUsers(){return this.afs.collection("users").valueChanges({idField:"email"})}getUserForMsg(o,a){const n=a.find(u=>u.email===o);return(null==n?void 0:n.email)||"Deleted"}}return(t=r).\u0275fac=function(o){return new(o||t)(e.LFG(m.$),e.LFG(v.Q1),e.LFG(M.ST))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),r})();const y=(t,r)=>({"my-message":t,"other-message":r});function U(t,r){if(1&t&&(e.TgZ(0,"ion-row")(1,"ion-col",10)(2,"b"),e._uU(3),e.qZA(),e._UZ(4,"br"),e.TgZ(5,"span"),e._uU(6),e.qZA(),e.TgZ(7,"div",11),e._UZ(8,"br"),e._uU(9),e.ALo(10,"date"),e.qZA()()()),2&t){const s=r.$implicit;e.xp6(1),e.Q6J("offset",s.myMsg?3:0)("ngClass",e.WLB(8,y,s.myMsg,!s.myMsg)),e.xp6(2),e.Oqu(s.from),e.xp6(3),e.hij("",s.msg," "),e.xp6(3),e.Oqu(e.xi3(10,5,null==s.createdAt?null:s.createdAt.toMillis(),"short"))}}const Z=[{path:"",component:(()=>{var t;class r{constructor(o,a,n){this.router=o,this.authService=a,this.chatService=n,this.newMsg=""}ngOnInit(){this.authService.getId().subscribe(o=>{o&&o.uid?this.messages=this.chatService.getChatMessages():(console.error("Usuario no autenticado. No se puede obtener el ID"),this.router.navigate(["loader"]))})}sendMessage(){this.chatService.addChatMessage({msg:this.newMsg}).then(()=>{this.newMsg="",this.content.scrollToBottom()}),setTimeout(()=>{this.router.navigate(["voice-recorder"])},2e3)}}return(t=r).\u0275fac=function(o){return new(o||t)(e.Y36(d.F0),e.Y36(m.$),e.Y36(P))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-chat"]],viewQuery:function(o,a){if(1&o&&e.Gf(i.W2,5),2&o){let n;e.iGM(n=e.CRH())&&(a.content=n.first)}},decls:16,vars:5,consts:[["color","primary"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["color","light"],[1,"ion-align-items-center"],["size","10"],["autoGrow","true","rows","1","maxLength","500",1,"message-input",3,"ngModel","ngModelChange"],["size","2"],["expand","block","fill","clear","color","primary",1,"msg-btn",3,"disabled","click"],["name","send","slot","icon-only"],["size","9",1,"message",3,"offset","ngClass"],[1,"time","ion-text-right"]],template:function(o,a){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"Mensaje"),e.qZA()()(),e.TgZ(4,"ion-content",1)(5,"ion-grid"),e.YNc(6,U,11,11,"ion-row",2),e.ALo(7,"async"),e.qZA()(),e.TgZ(8,"ion-footer")(9,"ion-toolbar",3)(10,"ion-row",4)(11,"ion-col",5)(12,"ion-textarea",6),e.NdJ("ngModelChange",function(u){return a.newMsg=u}),e.qZA()(),e.TgZ(13,"ion-col",7)(14,"ion-button",8),e.NdJ("click",function(){return a.sendMessage()}),e._UZ(15,"ion-icon",9),e.qZA()()()()()),2&o&&(e.xp6(6),e.Q6J("ngForOf",e.lcZ(7,3,a.messages)),e.xp6(6),e.Q6J("ngModel",a.newMsg),e.xp6(2),e.Q6J("disabled",""===a.newMsg))},dependencies:[c.mk,c.sg,l.JJ,l.On,i.YG,i.wI,i.W2,i.fr,i.jY,i.Gu,i.gu,i.Nd,i.g2,i.wd,i.sr,i.j9,c.Ov,c.uU],styles:[".userName[_ngcontent-%COMP%]{font-size:12px}.imageContainer[_ngcontent-%COMP%]{padding:0;max-width:100%!important}.imageContainerButton[_ngcontent-%COMP%]{padding:0!important}.message-input[_ngcontent-%COMP%]{width:100%;border:1px solid var(--ion-color-medium);border-radius:6px;background:#fff;resize:none;margin-top:0;--padding-start: 8px}.message[_ngcontent-%COMP%]{padding:10px!important;border-radius:10px!important;margin-bottom:4px!important;white-space:pre-wrap}.my-message[_ngcontent-%COMP%]{background:var(--ion-color-tertiary);color:#fff}.other-message[_ngcontent-%COMP%]{background:var(--ion-color-secondary);color:#fff}.time[_ngcontent-%COMP%]{color:#dfdfdf;float:right;font-size:small}"]}),r})()}];let x=(()=>{var t;class r{}return(t=r).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[d.Bz.forChild(Z),d.Bz]}),r})(),w=(()=>{var t;class r{}return(t=r).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[c.ez,l.u5,i.Pc,x]}),r})()}}]);