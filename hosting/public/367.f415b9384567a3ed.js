"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[367],{5961:(y,d,n)=>{n.d(d,{GW:()=>P,dk:()=>a,oK:()=>h});var h=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(h||{}),P=function(r){return r.Rear="REAR",r.Front="FRONT",r}(P||{}),a=function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r}(a||{})},367:(y,d,n)=>{n.r(d),n.d(d,{PhotoPageModule:()=>A});var h=n(6814),P=n(95),a=n(1929),r=n(2891),o=n(9212),g=n(5861),b=n(2726),v=n(5961);const T=(0,b.fo)("Camera",{web:()=>n.e(6468).then(n.bind(n,6468)).then(t=>new t.CameraWeb)});var m=n(2389),U=n(830);let S=(()=>{var t;class i{constructor(e,s){this.authService=e,this.storage=s,this.photos=[]}addNewToGallery(){var e=this;return(0,g.Z)(function*(){const s=yield T.getPhoto({resultType:v.dk.Uri,source:v.oK.Camera,quality:100}),u=e.authService.currentUser;if(u){const l=`img/${u.uid}/${(new Date).getTime()}.jpg`;yield e.uploadPhoto(s.webPath,l),e.photos.unshift({filepath:l,webviewPath:s.webPath})}else console.error("Usuario no autenticado. No se puede subir la imagen.")})()}getPhotosByUserId(e){var s=this;this.photos=[];const u=this.authService.currentUser;u?this.storage.ref(`users/${u.uid}/`).listAll().subscribe(f=>{f.items.forEach(function(){var I=(0,g.Z)(function*(p){const G=yield p.getDownloadURL();s.photos.push({filepath:p.fullPath,webviewPath:G})});return function(p){return I.apply(this,arguments)}}())}):console.error("Usuario no autenticado. No se puede subir la imagen.")}uploadPhoto(e,s){var u=this;return(0,g.Z)(function*(){try{const f=yield(yield fetch(e)).blob();yield u.storage.upload(s,f),console.log("Imagen subida exitosamente:",s)}catch(l){console.error("Error al subir la imagen:",l)}})()}}return(t=i).\u0275fac=function(e){return new(e||t)(o.LFG(m.$),o.LFG(U.Q1))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),i})();function F(t,i){if(1&t&&(o.TgZ(0,"ion-col",6),o._UZ(1,"ion-img",7),o.qZA()),2&t){const c=i.$implicit;o.xp6(1),o.Q6J("src",c.webviewPath)}}const Z=[{path:"",component:(()=>{var t;class i{constructor(e,s,u){this.photoService=e,this.router=s,this.authService=u}ngOnInit(){this.authService.getId().subscribe(e=>{e&&e.uid?this.photoService.getPhotosByUserId(e.uid):(console.error("Usuario no autenticado. No se puede obtener el ID"),this.router.navigate(["loader"]))})}addPhotoToGallery(){this.photoService.addNewToGallery(),setTimeout(()=>{this.router.navigate(["ubicacion"])},3e3)}}return(t=i).\u0275fac=function(e){return new(e||t)(o.Y36(S),o.Y36(r.F0),o.Y36(m.$))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-photo"]],decls:11,vars:3,consts:[[3,"translucent"],[3,"fullscreen"],["size","6",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","center","slot","fixed"],[3,"click"],["name","camera"],["size","6"],[3,"src"]],template:function(e,s){1&e&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o._uU(3," FOTOS "),o.qZA()()(),o.TgZ(4,"ion-content",1)(5,"ion-grid")(6,"ion-row"),o.YNc(7,F,2,1,"ion-col",2),o.qZA()(),o.TgZ(8,"ion-fab",3)(9,"ion-fab-button",4),o.NdJ("click",function(){return s.addPhotoToGallery()}),o._UZ(10,"ion-icon",5),o.qZA()()()),2&e&&(o.Q6J("translucent",!0),o.xp6(4),o.Q6J("fullscreen",!0),o.xp6(3),o.Q6J("ngForOf",s.photoService.photos))},dependencies:[h.sg,a.wI,a.W2,a.IJ,a.W4,a.jY,a.Gu,a.gu,a.Xz,a.Nd,a.wd,a.sr]}),i})()}];let w=(()=>{var t;class i{}return(t=i).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[r.Bz.forChild(Z),r.Bz]}),i})(),A=(()=>{var t;class i{}return(t=i).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[h.ez,P.u5,a.Pc,w]}),i})()}}]);